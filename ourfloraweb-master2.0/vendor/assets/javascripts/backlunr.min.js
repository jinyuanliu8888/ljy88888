!function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Backbone.Collection.Lunr=function(b){function d(b,c){this.search=a(this.search,this),this.processTerm=a(this.processTerm,this),this.reset=a(this.reset,this),this._lunrChange=a(this._lunrChange,this),this._lunrRemove=a(this._lunrRemove,this),this._lunrAdd=a(this._lunrAdd,this),this._lunrInitialize=a(this._lunrInitialize,this),d.__super__.constructor.call(this,b,c),this.on("add",this._lunrAdd),this.on("remove",this._lunrRemove),this.on("change",this._lunrChange)}return c(d,b),d.prototype.lunroptions={fields:[]},d.prototype._lunrInitialize=function(){var a;return a=this,a._lunrFields=[],this._lunrIndex=lunr(function(){var b,c,d,e,f;for(e=_.isFunction(a.lunroptions)?a.lunroptions(opt):_.extend({},a.lunroptions||(a.lunroptions={})),this.ref("cid"),f=e.fields,c=0,d=f.length;d>c;c++)b=f[c],a._lunrFields.push(b.name),this.field(b.name,_.omit(b,["isID","name"]))})},d.prototype._lunrAdd=function(a){var b,c,d,e,f;for(e=a.toJSON(),e.cid=a.cid,f=this._lunrFields,c=0,d=f.length;d>c;c++)b=f[c],e[b]=null==e[b]?"":e[b].toString();this._lunrIndex.add(e)},d.prototype._lunrRemove=function(a){var b;b=a.toJSON(),b.cid=a.cid,this._lunrIndex.remove(b)},d.prototype._lunrChange=function(a){var b,c,d,e,f;for(e=a.toJSON(),e.cid=a.cid,f=this._lunrFields,c=0,d=f.length;d>c;c++)b=f[c],e[b]=null==e[b]?"":e[b].toString();this._lunrIndex.update(e)},d.prototype.reset=function(a,b){var c,e,f,g;for(this._lunrInitialize(),d.__super__.reset.call(this,a,b),g=this.models,e=0,f=g.length;f>e;e++)c=g[e],this._lunrAdd(c);return this},d.prototype.processTerm=function(a){return a},d.prototype.search=function(a,b){var c,d,e,f;return null==b&&(b=!1),e=this._lunrIndex.search(this.processTerm(a)),b?e:(f=function(){var a,b,f;for(f=[],c=a=0,b=e.length;b>a;c=++a)d=e[c],f.push(this.get(d.ref));return f}.call(this),f.toJSON=function(a){var b,c;return c=function(){var c,d,e;for(e=[],c=0,d=this.length;d>c;c++)b=this[c],e.push(b.toJSON(a));return e}.call(this)},f)},d}(Backbone.Collection)}.call(this);